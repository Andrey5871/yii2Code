<?php
use yii\helpers\Url;
$session = Yii::$app->session;
$session->open();
$this->title = "Регистрация пользователя";
/* @var $this yii\web\View */

$this->title = '1100';
?>


<section class="headerContent torgPredl" style="background-image:url('<?=Yii::$app->request->baseUrl?>/img/bghead1100.png')">
  <div class="bgShadow"></div>
  <div class="container">
  <div class="row" style="padding-top:100px;">
  <div class="col-md-12 text-center text-white  text-md-left">
  <h2 class="t25 upc text-center">Собираетесь поступать на экономический <br>
факультет и не можете определиться с направлением?</h2>
  <hr class="hr-light">
  <h2 class="t25 upc text-center">Мануфакторинг объяснит, чего Вам можно ожидать <br> от каждого направления именно в интересующем<br>
Вас ВУЗе</h2>
  </div>
  </div>
  </div>
  </section>

<section class="openClose">
<div class="container">
<div class="row">
<div class="col-md-12">


</div>
</div>
<div class="row bgOpClose" style="background-image: url('/frontend/web/img/S3_Cell-phone-danger.jpg.png'); background-size: 700px auto; background-position: bottom right !important">


<div class="col-12 col-lg-6">
    <h1 class="t25 card-title">КОНСУЛЬТАЦИЯ <br>
ПЕРЕД ПОСТУПЛЕНИЕМ</h5>
<div class="card grey wow fadeInLeft" data-wow-duration="1s">
  <div class="img" style="margin-bottom: 20px; display: none">
    <img src="/frontend/web/img/S3_Cell-phone-danger.jpg.png" alt="" style="width: 100%">
  </div>
    <p class="card-text">Если Вы ещё не поступили в ВУЗ, но уже определились с факультетом - Экономический факультет.
Мануфакторинг проконсультирует Вас по телефону
об особенностях различных направлений, которые
существуют на экономическом факультете
интересующего Вас ВУЗа.
</p>


  </div>

 </div>



  <div class="col-12 col-md-12 ">
  </div>
  </div>
  <div class="row bgOpClose2 mt-5" style="background-image: url('/frontend/web/img/102028526-Grad.jpg.png'); background-size: 700px auto; background-position:  center left !important">
   <div class="col-12 col-lg-6"></div>

   <div class="col-12 col-lg-6 pt90">
    <h1 class="t25 card-title text-right">ОЖИДАНИЯ - РЕАЛЬНЫ</h5>
<div class="card grey text-right wow fadeInRight" data-wow-duration="1s">
  <div class="img" style="margin-bottom: 20px; display: none">
    <img src="/frontend/web/img/102028526-Grad.jpg.png" alt="" style="width: 100%">
  </div>
    <p class="card-text">Часто случается, что студенты в процессе обучения
понимают – их ожидания от занятий не совпали
с реальностью. Это оказывает влияние на Вашу
будущую карьеру и жизнь. Мы предлагаем за 1100 руб.
детально разъяснить все особенности каждого
направления на Экономическом факультете,
которые есть в интересующих Вас ВУЗах
и объясним, что Вас ждёт при поступлении
на различные направления

</p>


  </div>

 </div>



</div>
</div>
</section>


<section class="zebra">
    <div class="container">
      <div class="row">
            <div class="col-md-12">
                <h1 class="titl pb-4">Подготовка консультации</h1>
                <p class="pb-4">Перед разговором необходимо подготовить следующие данные:</p>
            </div>
        </div>
      <div class="row text-center textEducation">
          <div class="col-12 col-md-4 mb-4">
            <p><img src="<?=Yii::$app->request->baseUrl?>/img/university.png" alt=""></p>
            <p>Названия основных ВУЗов <br>
которые Вы рассматриваете <br>
в качестве потенциальных мест <br>
получения экономического<br>
 образования
</p>
          </div>
          <div class="col-12 col-md-4 mb-4">
            <p><img src="<?=Yii::$app->request->baseUrl?>/img/icom_ instruction.png" alt=""></p>
            <p>Основные направления обучения на <br>
              Экономических факультетах ВУЗов, <br>
              которые Вы считаете для себя <br>
              наиболее перспективным<br>
и (Например, Финансы и Кредит,<br>
  Мировая экономика,<br>
Бухгалтерский учёт и т.д.);
</p>
          </div>
          <div class="col-12 col-md-4 mb-4">
           <p><img src="<?=Yii::$app->request->baseUrl?>/img/icon_picture.png" alt=""></p>
           <p>Сделать фотографию расписания <br>
            предметов тех направлений, которые Вас<br>
            привлекают (или прислать<br>
             ссылку – на сайте ВУЗов обязано<br>
              должно быть расписание<br>
             занятий).  Фотография должна <br>
быть хорошо различимой
</p>
          </div>
      </div>


    </div>
</section>


<section class="openClose feedback">
<div class="container">
          <div class="row">
            <div class="col-12 col-md-6 leftText">
                  <h1 class="titl pb-4">Порядок действий</h1>
                  <ul>
                    <li>
                      <div class="row">
                        <div class="col-12 col-md-1 text-center numbers">
                          <p><strong>1.</strong></p>
                        </div>
                        <div class="col-12 col-md-2 images">
                          <img src="<?=Yii::$app->request->baseUrl?>/img/icon_transfer.png" alt="">
                        </div>
                        <div class="col-12 col-md-9 content">
                            <p><strong>Оплатите консультацию и переведите сумму 1100 руб. на счёт 2202 2001 1612 6440</strong></p>
                        </div>
                      </div>

                    </li>
                    <li>

                      <div class="row">
                        <div class="col-12 col-md-1 text-center numbers">
                          <p><strong>2.</strong></p>
                        </div>
                        <div class="col-12 col-md-2 images">
                          <img src="<?=Yii::$app->request->baseUrl?>/img/contactMessage.png" alt="">
                        </div>
                        <div class="col-12 col-md-9 content">
                            <p><strong>Внесите все необходимые данные,
которые представлены ниже в форму справа:</strong> <br>
- Ваш телефон <br>
- ФИО <br>
- названия интересующих Вас ВУЗов <br>
- интересующие Вас направления
в каждом из указанных ВУЗов <br>
- фотографию или ссылку на расписание занятий (на сайте любого ВУЗа
есть расписание занятий).  <br>
<strong>Расписание за все 4 года обучения
по каждому из направлений!</strong></p>
                        </div>
                      </div>

                        </li>
                    <li>

                  <div class="row">
                        <div class="col-12 col-md-1 text-center numbers">
                          <p><strong>3.</strong></p>
                        </div>
                        <div class="col-12 col-md-2 images">
                          <img src="<?=Yii::$app->request->baseUrl?>/img/icon_speech-bubble.png" alt="">
                        </div>
                        <div class="col-12 col-md-9 content">
                            <p><strong>Ожидайте СМС на номер Вашего телефона о готовности
начать консультацию</strong>
(подготовка консультации с нашей стороны займёт 1-2 часа)
</p>
                        </div>
                      </div>

                         </li>
                    <li>

                    <div class="row">
                        <div class="col-12 col-md-1 text-center numbers">
                          <p><strong>4.</strong></p>
                        </div>
                        <div class="col-12 col-md-2 images">
                          <img src="<?=Yii::$app->request->baseUrl?>/img/icon_telephone.png" alt="">
                        </div>
                        <div class="col-12 col-md-9 content">
                            <p><strong>После полученного СМС
уведомления, звоните по номеру <a href="tel:8(961)-523-39-06">8(961)-523-39-06</a></strong></p>
                  </div>
                </div>

</li>



                    <li>

              <div class="row">
                        <div class="col-12 col-md-1 text-center numbers">
                          <p><strong>5.</strong></p>
                        </div>
                        <div class="col-12 col-md-2 images">
                          <img src="<?=Yii::$app->request->baseUrl?>/img/icon_question.png" alt="">
                        </div>
                        <div class="col-12 col-md-9 content">
                            <p><strong>Если в ходе первого разговора,
Вы забудете о чём-то спросить
или по окончании разговора
возникнут дополнительные
вопросы – бесплатно позвоните второй раз – Мануфакторинг
ответит на все дополнительные
вопросы</strong> <br>
(в стоимость входит 2 звонка)</p>
                  </div>
                </div>

                         </li>
                  </ul>
            </div>
            <div class="col-12 col-md-6 rightForm">
                  <div class="form">

                        <form class="text-center">
                          <h2 class="titleForm">Заявка на консультацию</h2>
              <div class="form-group row">
                <div class="col-sm-12">
                  <input type="text" class="form-control form-control-lg" id="nubmerPhone" name="nubmerPhone" placeholder="Введите ваш телефон" autocomplete="off">
                   <div class="invalid-feedback">
                     Введите ваш телефон
                    </div>
                </div>
              </div>

               <div class="form-group row">
                <div class="col-sm-12">
                  <input type="text" class="form-control form-control-lg" id="numberCards" name="numberCards" placeholder="Введите ФИО" autocomplete="off">
                  <div class="invalid-feedback">
                     Введите ФИО
                    </div>
                </div>
              </div>


            <div class="appendUniver">
                  <div class="form-group row" style="position: relative;">
                <div class="col-sm-12">
                  <div class="addUniver">
                      <input type="text" class="form-control form-control-lg" id="nameUniver" name="nameUniver" placeholder="Введите название инетресующего ВУЗа" autocomplete="off">
                      <div class="invalid-feedback">
                     Введите название инетресующего ВУЗа
                    </div>
                    <!-- BEGINVIEWeducation -->
    <div class="education" style="display: none">
      <ul class="list-group">
      <?php if ($_GET['search']): ?>
          <?php foreach ($educationArr as $education): ?>
                      <li idEducation="<?=$education['id']?>" class="list-group-item list-group-item-action list-group-item-default"><?=$education['subName']?> <b><?=$education['name']?></b></li>
            <?php endforeach ?>

        </ul>
        <?php else: ?>
          <li class="list-group-item list-group-item-action">
            Поиск учебного заведения...
          </li>
            </ul>
      <?php endif ?>

    </div>
    <!-- ENDVIEWeducation -->
                      <input type="button" id="addUniverButton" value="+">
                  </div>

                </div>
              </div>

              <div class="form-group row">
                <div class="col-sm-12">
                  <input type="text" class="form-control form-control-lg" id="economNaprav" name="economNaprav" placeholder="Введите экономическое направление ВУЗа" autocomplete="off">
                  <div class="invalid-feedback">
                     Введите экономическое направление ВУЗа
                    </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12 text-center">
                      <div class="result">

                </div>
                </div>
              </div>

              <div class="form-group row">
                <div class="col-sm-12">
                  <div class="actionVew">

                  </div>
                  <div class="fileHref">
                        <input type="text" class="form-control form-control-lg" id="timeTable" name="timeTable" placeholder="Введите ссылку на расписание занятий в данном ВУЗе" autocomplete="off">
                        <div class="invalid-feedback">
                     Введите ссылку на расписание занятий в данном ВУЗе
                    </div>
                  <button type="button" class="buttonFile"> <img src="<?=Yii::$app->request->baseUrl?>/img/fileHref.png" alt=""></button>
                  <input type="file" name="imgFile" id="imgFile" style="display: none">
                  </div>
                </div>
              </div>
              </div>




                <button class="btn btn-grey sendForms" type="button">Отправить</button>
              </form>
                  </div>
            </div>
          </div>
</div>
</section>


<script>

  jQuery(document).ready(function($) {
    $("form #nubmerPhone").mask("+7(999)999-99-99");

                  var formData = new FormData();
              $(".appendUniver .buttonFile").click(function(){
                  var file = $(this).parent().children("#imgFile");
                  file.click();

                    file.on('change', function(){
                      var img = file;
                      if (img[0].files[0].type == "image/jpeg" || img[0].files[0].type == "image/png") {
                            if (img[0].files[0].size < 5000000) {
                              formData.set(img[0].files[0].name, img[0].files[0]);
                              var reader = new FileReader();
                              reader.onload = function(e){
                                var dataURL = e.target.result;
                                file.parent().parent().parent().parent().children(".row").children(".col-12").children(".result").html("<img src='"+dataURL+"' style='max-width:100%; max-height: 500px; margin: 0px'>");
                              };
                                var url = reader.readAsDataURL(img[0].files[0]);
                                file.parent().parent().parent().parent().children(".form-group").children(".col-sm-12").children(".actionVew").html("<div class='alert alert-success mt-4' role='alert'>Изображение готово к загрузке!</div>");
                                file.parent().children("#timeTable").val(img[0].files[0].name);
                                file.parent().children("#timeTable").attr("disabled", "disabled");
                            }else{
                                file.parent().parent().parent().parent().children(".form-group").children(".col-sm-12").children(".actionVew").html("<div class='alert alert-danger mt-4' role='alert'>Ошибка, размер изображения превышает 5MB!</div>");
                            }
                      }else{
                          file.parent().parent().parent().parent().children(".form-group").children(".col-sm-12").children(".actionVew").html("<div class='alert alert-danger mt-4' role='alert'>Ошибка, этот файл не является изображением!</div>");
                      }

                    });
              });

            $(".appendUniver #addUniverButton").click(function(){
              var html = "<div class='univer'><div class='form-group row'><div class='col-sm-12'><div class='addUniver'><input type='text' class='form-control form-control-lg' id='nameUniver' name='nameUniver' placeholder='Введите название инетресующего ВУЗа'><div class='invalid-feedback'>Введите название инетресующего ВУЗа</div><!-- BEGINVIEWeducation --><div class='education' style='display: none'><ul class='list-group'><?php if ($_GET['search']): ?><?php foreach ($educationArr as $education): ?><li idEducation='<?=$education['id']?>' class='list-group-item list-group-item-action list-group-item-default'><?=$education['subName']?> <b><?=$education['name']?></b></li><?php endforeach ?></ul><?php else: ?><li class='list-group-item list-group-item-action'>Поиск учебного заведения...</li></ul><?php endif ?></div><!-- ENDVIEWeducation --><input type='button' id='deleteUniver' value='-'></div></div></div><div class='form-group row'><div class='col-sm-12'><input type='text' class='form-control form-control-lg' id='economNaprav' name='economNaprav' placeholder='Введите экономическое направление ВУЗа'><div class='invalid-feedback'>Введите экономическое направление ВУЗа</div></div></div><div class='row'><div class='col-12 text-center'><div class='result'></div></div></div><div class='form-group row'><div class='col-sm-12'><div class='actionVew'></div><div class='fileHref'><input type='text' class='form-control form-control-lg' id='timeTable' name='timeTable' placeholder='Введите ссылку на расписание занятий в данном ВУЗе'><div class='invalid-feedback'>Введите ссылку на расписание занятий в данном ВУЗе</div><button type='button' class='buttonFile'> <img src='<?=Yii::$app->request->baseUrl?>/img/fileHref.png' alt=''></button><input type='file' name='imgFile' id='imgFile' style='display: none'></div></div></div></div>"

              $(".appendUniver") .append(html);


                  $(".univer .buttonFile").click(function(){
                        var file = $(this).parent().children("#imgFile");
                  file.click();

                    file.on('change', function(){
                      var img = file;
                      if (img[0].files[0].type == "image/jpeg" || img[0].files[0].type == "image/png") {
                            if (img[0].files[0].size < 5000000) {
                              formData.set(img[0].files[0].name, img[0].files[0]);
                              var reader = new FileReader();
                              reader.onload = function(e){
                                var dataURL = e.target.result;
                                file.parent().parent().parent().parent().children(".row").children(".col-12").children(".result").html("<img src='"+dataURL+"' style='max-width:500px; max-height: 500px; margin: 10px'>");
                              };
                                var url = reader.readAsDataURL(img[0].files[0]);
                                file.parent().parent().parent().parent().children(".form-group").children(".col-sm-12").children(".actionVew").html("<div class='alert alert-success' role='alert'>Изображение готово к загрузке!</div>");
                                file.parent().children("#timeTable").val(img[0].files[0].name);
                                file.parent().children("#timeTable").attr("disabled", "disabled");
                            }else{
                                file.parent().parent().parent().parent().children(".form-group").children(".col-sm-12").children(".actionVew").html("<div class='alert alert-danger' role='alert'>Ошибка, размер изображения превышает 5MB!</div>");
                            }
                      }else{
                          file.parent().parent().parent().parent().children(".form-group").children(".col-sm-12").children(".actionVew").html("<div class='alert alert-danger' role='alert'>Ошибка, этот файл не является изображением!</div>");
                      }

                    });
              });

              $(".appendUniver #deleteUniver").click(function(){
                  $(this).parent().parent().parent().parent().remove();
            });


              /*При попадании фокуса в input показывает выпадающий список учебных заведений*/
      $(".univer input[name=nameUniver]").focus(function(){
        $(this).val("");
        $(this).removeAttr('idEducation');
        $(this).next(".education").fadeIn(100);
          $(this).on("input", function(){
            var lengElem = $(this).val().length;
            var elemVal = $(this).val();
            var elem = $(this);
            /*Если длина введенных символов в inut будет больше 2, то отправляем запрос по поиску учебных заведений*/
            if (lengElem > 1) {
              $.ajax({
                url: '<?=Url::to(['site/money1100', 'search'=>'education'])?>',
                type: 'POST',
                dataType: 'html',
                data: {'_csrf-frontend': '<?=Yii::$app->request->getCsrfToken()?>', 'getEducation': 'education', 'nameEducation':elemVal},
                beforeSend: function(){
                  elem.next().next(".education").html("<li class='list-group-item list-group-item-action text-center'><img src='<?=Yii::$app->request->baseUrl?>/img/load.gif'></li>");
                }
              })
              .done(function(data) {
                var beginCityResult = data.indexOf("<!-- BEGINVIEWeducation -->");
                var endCityResutl = data.indexOf("<!-- ENDVIEWeducation -->");
                var result = data.substring(beginCityResult, endCityResutl);
                elem.next().next(".education").html(result);
                elem.next().next(".education").css({
                  display: 'block',
                });
                elem.next().next(".education").children(".education").css({
                  display: 'block',
                });

                elem.next().next(".education").children(".education").children('ul').children('li').on("click", function(e){
                    e.preventDefault();
                    elem.val($(this).text());
                    elem.attr("idEducation", $(this).attr("idEducation"));
                    elem.next().next(".education").fadeOut(100);
                });
              })
              .fail(function(data) {
                console.log("error - " + data);
              })
            }else{
              elem.next().next(".education").children("ul").html("<li class='list-group-item list-group-item-action'>Поиск учебного заведения...</li>");
            }

          })
      });
      $(".univer input[name=nameUniver]").focusout(function(event) {
        var elem = $(this);
         setTimeout(function(){
          elem.next(".univer .education").fadeOut(100);
        }, 300);

      });

            });


/*При попадании фокуса в input показывает выпадающий список учебных заведений*/
      $("form input[name=nameUniver]").focus(function(){
        $(this).val("");
        $(this).removeAttr('idEducation');
        $(this).next(".education").fadeIn(100);
          $(this).on("input", function(){
            var lengElem = $(this).val().length;
            var elemVal = $(this).val();
            var elem = $(this);
            /*Если длина введенных символов в inut будет больше 2, то отправляем запрос по поиску учебных заведений*/
            if (lengElem > 1) {
              $.ajax({
                url: '<?=Url::to(['site/money1100', 'search'=>'education'])?>',
                type: 'POST',
                dataType: 'html',
                data: {'_csrf-frontend': '<?=Yii::$app->request->getCsrfToken()?>', 'getEducation': 'education', 'nameEducation':elemVal},
                beforeSend: function(){
                  elem.next().next(".education").html("<li class='list-group-item list-group-item-action text-center'><img src='<?=Yii::$app->request->baseUrl?>/img/load.gif'></li>");
                }
              })
              .done(function(data) {
                var beginCityResult = data.indexOf("<!-- BEGINVIEWeducation -->");
                var endCityResutl = data.indexOf("<!-- ENDVIEWeducation -->");
                var result = data.substring(beginCityResult, endCityResutl);
                elem.next().next(".education").html(result);
                elem.next().next(".education").css({
                  display: 'block',
                });
                elem.next().next(".education").children(".education").css({
                  display: 'block',
                });

               elem.next().next(".education").children(".education").children('ul').children('li').on("click", function(e){
                    e.preventDefault();
                    elem.val($(this).text());
                    elem.attr("idEducation", $(this).attr("idEducation"));
                    elem.next().next(".education").fadeOut(100);
                });
              })
              .fail(function(data) {
                console.log("error - " + data);
              })
            }else{
              $(".education ul").html("<li class='list-group-item list-group-item-action'>Поиск учебного заведения...</li>");
            }

          })
      });
      $("form input[name=nameUniver]").focusout(function(event) {
        var elem = $(this);
         setTimeout(function(){
          elem.next(".education").fadeOut(100);
        }, 300);

      });



              $(".sendForms").click(function(){
            var inputText = $("form input[type=text]");
            var actionError = [];
            inputText.each(function(index, el) {
              $(el).removeClass("is-invalid");
              if ($(el).val() == "") {
                var textInput = $(el).attr('placeholder');
                  $(el).parent().children(".invalid-feedback").text(textInput);
                  $(el).addClass("is-invalid");
                  actionError.push("text");

              }else if ($(el).val().length > $(el).attr("length")) {
                  $(el).parent().children(".invalid-feedback").text("Вы ввели превышающее количество символов!");
                  $(el).addClass("is-invalid");
                  actionError.push("length");

              }else if($("form #nameUniver").attr("ideducation") == undefined){
                        $("form #nameUniver").parent().children(".invalid-feedback").text("Ошибка, вы не выбрали ВУЗ или такого ВУЗа не существует в базе данных!");
                  $("form #nameUniver").addClass("is-invalid");
                  actionError.push("education");
                }
            });

            if (actionError.length < 1) {
                    var phone = $("form #nubmerPhone").val();
                    var numberCards = $("form #numberCards").val();
                     if ($("form input[name=nameUniver]").length > 1) {
                      var univers = [];
                      var economy = [];
                      var images = [];
                      var file = $("form input[name=imgFile]");
                      var token = '<?=Yii::$app->request->getCsrfToken()?>';
                      file.each(function(index, el) {

                            if ($(el)[0].files.length < 1) {
                                  images.push($(el).parent().children("#timeTable").val());
                            }else{
                              for(var pair of formData.entries()) {
                   $("form input[name=timeTable]").each(function(index, el) {
                          if ($(el).val() == pair[1].name) {
                            images.push(pair[1]);
                          }
                   });
                        }
                            }
                      });


                        $("form input[name=nameUniver]").each(function(index, el) {
                          univers.push($(el).val());
                        });
                        $("form input[name=economNaprav]").each(function(index, el) {
                          economy.push($(el).val());
                        });
                     }else{
                      var univers = $("form input[name=nameUniver]").val();
                      var economy = $("form input[name=economNaprav]").val();
                      var images;
                      var file = $("form #imgFile");
                          if (file[0].files.length < 1) {
                             images  = file.parent().children("#timeTable").val();
                          }else{
                            images = formData;
                          }


                     }

                     formData.set('phone', phone);
                     formData.set('numberCards', numberCards);
                     formData.set('univers', univers);
                     formData.set('economy', economy);
                     formData.set('images', images);
                      formData.set('_csrf-frontend', token);



                    $.ajax({
                            url: '<?=Url::to(['site/money1100', 'request'=>'request'])?>',
                            type: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            beforeSend: function(){
                                $(".rightForm .form form").html("<div class='text-center' style='width:100%; height: 100%; position:relative;'><img style='margin: 0; position: absolute; top: 50%; left: 50%; margin-right: -50%; transform: translate(-50%, -50%);' src='<?=Yii::$app->request->baseUrl?>/img/load.gif'>");
                            }
                          })
                          .done(function(data) {
                              $(".rightForm .form form").html("<div class='text-center' style='width:100%; height: 100%; position:relative;'><div style='margin: 0; width:100%; position: absolute; top: 50%; left: 50%; margin-right: -50%; transform: translate(-50%, -50%);' class='alert alert-success' role='alert'><h2>Ваша заявка отправлена!</h2></div></div>");
                          })
                          .fail(function() {
                            $("body").animate({scrollTop:0}, '500');
                            $(".errorServer").show();
                          })

                }
              });
  });
</script>
